<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Calendar with Prediction Info</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            max-width: 1200px;
            margin: 30px auto;
            gap: 20px;
            padding: 0 20px;
        }

        .calendar {
            flex: 2;
            min-width: 600px;
            background-color: #fff;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            height: 530px;
        }

        .prediction-panel {
            flex: 1;
            min-width: 300px;
            background-color: #ffffff;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            height: 530px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .btn {
            background-color: #08997a;
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .btn:hover {
            background-color: #067a64;
        }

        .days-of-week, .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .days-of-week div, .day {
            padding: 10px;
            border-radius: 5px;
        }

        .days-of-week div {
            background-color: #08997a;
            color: #fff;
            margin-top: 20px;
            text-align: center;
        }

        .day {
            background-color: #f0f0f0;
            cursor: pointer;
            text-align: center;
        }

        .day:hover {
            background-color: #05cca1;
            color: white;
        }

        .event-day {
            background-color: #ff4d4d !important;
            color: white;
        }

        .prediction-panel h3 {
            margin-bottom: 15px;
            color: #08997a;
        }

        .info-box {
            display: flex;
            flex-direction: column;
            font-size: 16px;
            color: #333;
            gap: 20px;
        }

        .info-box div {
            background-color: #f7f7f7;
            padding: 15px;
            border-radius: 5px;
        }

        .info-box label {
            font-weight: bold;
        }

        @media (max-width: 900px) {
            .container {
                flex-direction: column;
            }

            .calendar, .prediction-panel {
                width: 100%;
                min-width: unset;
                height: auto;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="calendar">
        <div class="header">
            <button class="btn" id="prevMonthBtn">Previous</button>
            <h2 id="monthYear"></h2>
            <div id="liveTime">00:00:00</div>
            <button class="btn" id="nextMonthBtn">Next</button>
        </div>
        <div class="days-of-week">
            <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
        </div>
        <div class="days" id="calendarDays"></div>
    </div>

    <div class="prediction-panel">
        <h3>Planting and Harvest Info</h3>
        <div class="info-box">
            <div>
                <label>Planting Date:</label>
                <span id="plantingDate">Not selected</span>
            </div>
            <div>
                <label>Predicted Harvest Month:</label>
                <span id="harvestMonth">Not predicted</span>
            </div>
        </div>
    </div>
</div>

<script>
    const monthNames = ["January", "February", "March", "April", "May", "June",
                        "July", "August", "September", "October", "November", "December"];
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    let events = [];

    function updateClock() {
        const now = new Date();
        document.getElementById("liveTime").textContent = now.toLocaleTimeString();
    }
    setInterval(updateClock, 1000);
    updateClock();

    function fetchEvents() {
        fetch('/api/get-events/')
            .then(res => res.json())
            .then(data => {
                events = data.events;
                generateCalendar(currentMonth, currentYear);
                updatePredictionPanelFromData(events);
            });
    }

    function generateCalendar(month, year) {
        const calendarDays = document.getElementById('calendarDays');
        calendarDays.innerHTML = '';
        document.getElementById('monthYear').innerText = `${monthNames[month]} ${year}`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) {
            calendarDays.appendChild(document.createElement('div'));
        }

        for (let day = 1; day <= daysInMonth; day++) {
            const dayDiv = document.createElement('div');
            dayDiv.classList.add('day');
            dayDiv.textContent = day;

            const today = new Date();
            if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                dayDiv.style.color = "black";
                dayDiv.style.border = "2px solid darkgreen";
            }

            const eventForDay = events.find(e => e.day === day && e.month === month && e.year === year);
            if (eventForDay) {
                dayDiv.classList.add('event-day');
                dayDiv.title = eventForDay.title;
            }

            calendarDays.appendChild(dayDiv);
        }
    }

    function updatePredictionPanel(plantingDate, harvestMonth) {
        document.getElementById('plantingDate').textContent = plantingDate || 'Not selected';
        document.getElementById('harvestMonth').textContent = harvestMonth || 'Not predicted';
    }

    function updatePredictionPanelFromData(events) {
        if (events.length > 0) {
            const first = events[0]; // Replace with smarter logic if needed
            const plantingDate = `${first.year}-${String(first.month + 1).padStart(2, '0')}-${String(first.day).padStart(2, '0')}`;
            const harvestMonth = first.harvest_month || "Unknown";
            updatePredictionPanel(plantingDate, harvestMonth);
        }
    }

    document.getElementById('prevMonthBtn').onclick = () => {
        if (currentMonth === 0) {
            currentMonth = 11;
            currentYear--;
        } else {
            currentMonth--;
        }
        generateCalendar(currentMonth, currentYear);
    };

    document.getElementById('nextMonthBtn').onclick = () => {
        if (currentMonth === 11) {
            currentMonth = 0;
            currentYear++;
        } else {
            currentMonth++;
        }
        generateCalendar(currentMonth, currentYear);
    };

    generateCalendar(currentMonth, currentYear);
    fetchEvents();
</script>

</body>
</html>
